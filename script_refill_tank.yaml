# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2023 Ilia Sotnikov
---
if:
  condition:
    lambda: |-
      #include "esphome/components/sprinkler/sprinkler.h"

      auto controller = ${sprinkler};
      return controller->controller_state()
        != esphome::sprinkler::SprinklerState::IDLE;
  then:
    - sprinkler.pause: ${sprinkler}
    - switch.turn_on: ${relay}
    - lambda: |-
        #ifdef HAS_DISPLAY
        ${display_id}->update();
        #endif
    - delay: ${refill_relay_pulse_duration}
    - switch.turn_off: ${relay}
    - sprinkler.resume: ${sprinkler}
    - lambda: |-
        #ifdef HAS_DISPLAY
        ${display_id}->update();
        #endif
